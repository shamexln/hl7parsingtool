<div class="odx-app-page patient-page">
  <odx-area-header size="large">
    {{ 'PATIENT.HEADER' | translate }}
  </odx-area-header>

  <div class="odx-app-page__content-scroll">
    <div class="odx-app-page__content-inner">
      <form odxForm [disabled]="false" odxLayout="grid" [formGroup]="formGroup">
        <odx-form-field
          [variant]="fieldstyle"
        >
          <input
            type="text"
            formControlName="patientid"
            [attr.placeholder]="('PATIENT.INPUT.PATIENT_ID_PLACEHOLDER' | translate)"
            odxFormFieldControl
            required (keyup.enter)="queryPatient(1)"
          />
        </odx-form-field>

        <odx-form-field
          [label]="('PATIENT.DATE.FROM_LABEL' | translate)"
          [variant]="fieldstyle"
        >
          <odx-datepicker
            formControlName="startdate"
            [attr.placeholder]="('PATIENT.DATE.START_PLACEHOLDER' | translate)"
            odxFormFieldControl
          >
            <input odxDatepickerControl/>
          </odx-datepicker>
        </odx-form-field>

        <odx-form-field
          [label]="('PATIENT.DATE.TO_LABEL' | translate)"
          [variant]="fieldstyle"
        >
          <odx-datepicker
            formControlName="enddate"
            [attr.placeholder]="('PATIENT.DATE.END_PLACEHOLDER' | translate)"
            odxFormFieldControl
          >
            <input odxDatepickerControl/>
          </odx-datepicker>
        </odx-form-field>

        <button odxButton (click)="queryPatient(1)">{{ 'PATIENT.ACTIONS.SEARCH' | translate }}</button>

        <button odxButton (click)="exportAllDataToExcel()" [disabled]="!patientData() || patientData().length === 0">
          {{ 'PATIENT.ACTIONS.EXPORT_ALL' | translate }}
        </button>

        <odx-form-field
          [variant]="fieldstyle"
        >
          <odx-select
            (optionSelected)="handlePageSizeChange()"
            name="pageSizeValue"
            [stringify]="stringify"
            [identityMatcher]="identityMatcher"
            formControlName="pageSizeValue"
            odxFormFieldControl
            style="width: 100%"
          >
            @for (item of selectOptions; track item.value) {
              <odx-select-option [value]="item">
                {{ item.label }}
              </odx-select-option>
            }
          </odx-select>

        </odx-form-field>
      </form>
      <div class="table-flow">
        <table odxDataTable [variant]="variantValue" [dataSource]="dataSource()"
               [displayedColumns]="displayedColumns">

          <ng-container odxColumnDef="device_id">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.DEVICE_ID' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.device_id }}</td>
          </ng-container>

          <ng-container odxColumnDef="local_time">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.LOCAL_TIME' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.local_time }}</td>
          </ng-container>

          <ng-container odxColumnDef="Date">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.DATE' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.Date }}</td>
          </ng-container>

          <ng-container odxColumnDef="Time">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.TIME' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.Time }}</td>
          </ng-container>

          <ng-container odxColumnDef="Hour">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.HOUR' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.Hour }}</td>
          </ng-container>

          <ng-container odxColumnDef="bed_label">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.BED_LABEL' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.bed_label }}</td>
          </ng-container>

          <ng-container odxColumnDef="pat_ID">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.PATIENT_ID' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.pat_ID }}</td>
          </ng-container>

          <ng-container odxColumnDef="mon_unit">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.MON_UNIT' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.mon_unit }}</td>
          </ng-container>

          <ng-container odxColumnDef="care_unit">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.CARE_UNIT' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.care_unit }}</td>
          </ng-container>

          <ng-container odxColumnDef="alarm_grade">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.ALARM_GRADE' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.alarm_grade }}</td>
          </ng-container>

          <ng-container odxColumnDef="alarm_state">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.ALARM_STATE' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.alarm_state }}</td>
          </ng-container>

          <ng-container odxColumnDef="Alarm Grade 2">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.ALARM_GRADE_2' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element['Alarm Grade 2'] }}</td>
          </ng-container>

          <ng-container odxColumnDef="alarm_message">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.ALARM_MESSAGE' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.alarm_message }}</td>
          </ng-container>

          <ng-container odxColumnDef="param_id">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.PARAM_ID' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.param_id }}</td>
          </ng-container>

          <ng-container odxColumnDef="param_value">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.PARAM_VALUE' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.param_value }}</td>
          </ng-container>

          <ng-container odxColumnDef="param_uom">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.PARAM_UOM' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.param_uom }}</td>
          </ng-container>

          <ng-container odxColumnDef="param_upper_lim">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.PARAM_UPPER_LIM' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.param_upper_lim }}</td>
          </ng-container>

          <ng-container odxColumnDef="param_lower_lim">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.PARAM_LOWER_LIM' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.param_lower_lim }}</td>
          </ng-container>

          <ng-container odxColumnDef="Limit_Violation_Type">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.LIMIT_VIOLATION_TYPE' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.Limit_Violation_Type }}</td>
          </ng-container>

          <ng-container odxColumnDef="Limit_Violation_Value">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.LIMIT_VIOLATION_VALUE' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.Limit_Violation_Value }}</td>
          </ng-container>

          <ng-container odxColumnDef="sourcechannel">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.ALARM_SOURCE' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.sourcechannel }}</td>
          </ng-container>

          <ng-container odxColumnDef="onset_tick">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.ONSET_TICK' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.onset_tick }}</td>
          </ng-container>

          <ng-container odxColumnDef="alarm_duration">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.ALARM_DURATION' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.alarm_duration }}</td>
          </ng-container>

          <ng-container odxColumnDef="change_time(UTC)">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.CHANGE_TIME_UTC' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element['change_time(UTC)'] }}</td>
          </ng-container>

          <ng-container odxColumnDef="change_tick">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.CHANGE_TICK' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.change_tick }}</td>
          </ng-container>

          <ng-container odxColumnDef="aborted">
            <th odxHeaderCell *odxHeaderCellDef>{{ 'PATIENT.TABLE.ABORTED' | translate }}</th>
            <td odxCell *odxCellDef="let element">{{ element.aborted }}</td>
          </ng-container>

          <!-- 无数据的展示 -->
          <odx-table-empty>{{ 'PATIENT.TABLE.EMPTY' | translate }}</odx-table-empty>

        </table>

        <div class="odx-paginator-footer">
          <odx-paginator
            [pageSize]="pageSize"
            [length]="totalItems"
            [pageIndex]="page - 1"
            (pageChanged)="onPageChange($event)"
          />
        </div>
      </div>
    </div>
  </div>
</div>
