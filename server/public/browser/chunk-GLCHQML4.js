import{c as J}from"./chunk-SRH32LXR.js";import{a as R}from"./chunk-ZIXO3TMD.js";import"./chunk-I5SXR335.js";import{c as q,d as K}from"./chunk-LDSH5ZEA.js";import{a as T,d as V,e as D,g as F,i as A,j as B,r as W,s as H}from"./chunk-EUUJERWT.js";import"./chunk-IVREERM6.js";import{$a as w,Fa as h,Ja as P,La as d,Na as I,Ob as E,Pb as k,Sb as G,Uc as j,Va as a,Vc as z,Wa as s,Xa as M,Y as p,Z as g,cb as x,cc as N,cd as U,eb as m,ed as X,gd as Q,hd as Y,id as Z,ob as u,pa as O,pb as b,qa as o,rb as L,sb as y,tb as v,ua as C,yb as f,za as S,zb as _}from"./chunk-PQW76BEZ.js";function ee(i,n){i&1&&(a(0,"span",25),u(1,"\u2713"),s())}function te(i,n){if(i&1){let e=w();a(0,"li",21)(1,"button",22),x("click",function(){let r=p(e).$implicit,l=m(2);return g(l.setLang(r.code))})("keydown.enter",function(){let r=p(e).$implicit,l=m(2);return g(l.setLang(r.code))})("keydown.space",function(){let r=p(e).$implicit,l=m(2);return g(l.setLang(r.code))}),a(2,"span",23),u(3),f(4,"translate"),s(),h(5,ee,2,0,"span",24),s()()}if(i&2){let e=n.$implicit,t=m(2);o(),I("selected",t.selectedLang===e.code),o(2),b(_(4,4,e.labelKey)),o(2),d("ngIf",t.selectedLang===e.code)}}function ne(i,n){if(i&1){let e=w();a(0,"div",18),x("click",function(r){return p(e),g(r.stopPropagation())}),a(1,"ul",19),h(2,te,6,6,"li",20),s()()}if(i&2){let e=m();o(2),d("ngForOf",e.languages)}}function ie(i,n){if(i&1){let e=w();a(0,"odx-form-field")(1,"input",26),f(2,"translate"),v("ngModelChange",function(r){p(e);let l=m();return y(l.confirmPassword,r)||(l.confirmPassword=r),g(r)}),s()()}if(i&2){let e=m();o(),L("ngModel",e.confirmPassword),d("placeholder",_(2,2,"LOGIN.CONFIRM_PASSWORD_PLACEHOLDER"))}}function oe(i,n){if(i&1&&(a(0,"div",27),u(1),s()),i&2){let e=m();o(),b(e.error)}}function re(i,n){i&1&&(a(0,"div",28),u(1),f(2,"translate"),s()),i&2&&(o(),b(_(2,1,"LOGIN.LOGGED_OUT")))}var $=class i{constructor(n,e,t){this.auth=n;this.router=e;this.translate=t;this.selectedLang=t.currentLang||t.getDefaultLang()||"en"}username="admin";password="";confirmPassword="";isFirstLogin=!1;error="";loading=!1;selectedLang="en";showLangSelect=!1;languages=[{code:"en",labelKey:"LOGIN.LANGUAGE.EN"},{code:"fr",labelKey:"LOGIN.LANGUAGE.FR"},{code:"de",labelKey:"LOGIN.LANGUAGE.DE"},{code:"es",labelKey:"LOGIN.LANGUAGE.ES"}];ngOnInit(){this.auth.setupRequired().subscribe(n=>{this.isFirstLogin=!!n?.setupRequired,this.isFirstLogin&&n.status=="initial"?this.error=this.translate.instant("LOGIN.LOGGED_OUT"):this.isFirstLogin&&n.status=="expired"&&(this.error=this.translate.instant("LOGIN.ERROR_PASSWORD_EXPIRED"))})}toggleLangSelect(){this.showLangSelect=!this.showLangSelect}onDocClick(n){n.target.closest?.(".login-lang-container")||(this.showLangSelect=!1)}setLang(n){let t=["en","fr","de","es"].includes(n)?n:"en";this.translate.use(t),this.selectedLang=t;try{localStorage.setItem("hl7_lang",t)}catch{}this.showLangSelect=!1}submit(){if(this.error="",this.loading=!0,this.isFirstLogin){if(this.password!==this.confirmPassword){this.loading=!1,this.error=this.translate.instant("MSG.PasswordMismatch");return}if(this.password.length<8){this.loading=!1,this.error=this.translate.instant("MSG.LengthNotEnough");return}this.auth.setupInitial(this.username,this.password,this.confirmPassword).subscribe({next:n=>{n.success?this.auth.login(this.username,this.password).subscribe({next:e=>{this.loading=!1,e?this.router.navigate(["/patient-query"]):this.error=this.translate.instant("MSG.PasswordInvalid")},error:()=>{this.loading=!1,this.error=this.translate.instant("MSG.PasswordInvalid")}}):(this.loading=!1,this.error=this.translate.instant("MSG.LoginFailed"))},error:n=>{let e=n?.error?.message;this.error=typeof e=="string"?this.translate.instant(e):this.translate.instant("MSG.LoginFailed"),this.loading=!1}});return}this.auth.login(this.username,this.password).subscribe({next:n=>{this.loading=!1,n?this.router.navigate(["/patient-query"]):this.error=this.translate.instant("MSG.PasswordInvalid")},error:n=>{if(this.loading=!1,n?.status===403&&n?.error?.passwordExpired){this.error=this.translate.instant("LOGIN.ERROR_PASSWORD_EXPIRED"),window.location.reload();return}this.error=this.translate.instant("MSG.PasswordInvalid")}})}static \u0275fac=function(e){return new(e||i)(C(R),C(N),C(Q))};static \u0275cmp=S({type:i,selectors:[["app-login"]],hostBindings:function(e,t){e&1&&x("click",function(l){return t.onDocClick(l)},!1,O)},decls:25,vars:21,consts:[["f","ngForm"],[1,"login-wrapper"],[1,"login-lang-container"],["type","button","aria-haspopup","true","aria-label","Change language",1,"lang-icon-btn",3,"click"],["name","language","size","medium",1,"lang-icon"],["class","lang-panel",3,"click",4,"ngIf"],[1,"login-card"],["aria-hidden","true",1,"logo-box"],[1,"login-form",3,"ngSubmit"],[3,"readonly","disabled"],["id","username","name","username","type","text","required","",3,"ngModelChange","ngModel","placeholder","readonly","disabled"],["id","password","name","password","type","password","required","",3,"ngModelChange","ngModel","placeholder"],[4,"ngIf"],["odxButton","","type","submit",1,"login-button",3,"disabled"],["class","error",4,"ngIf"],["class","logout-msg",4,"ngIf"],["aria-hidden","true",1,"login-footer"],["src","/draeger-logo.svg","alt","Dr\xE4ger",1,"draeger-logo"],[1,"lang-panel",3,"click"],["role","menu",1,"lang-list"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem"],["type","button","tabindex","0",1,"lang-item",3,"click","keydown.enter","keydown.space"],[1,"lang-text"],["class","checkmark",4,"ngIf"],[1,"checkmark"],["id","confirmPassword","name","confirmPassword","type","password","required","",3,"ngModelChange","ngModel","placeholder"],[1,"error"],[1,"logout-msg"]],template:function(e,t){if(e&1){let r=w();a(0,"div",1)(1,"div",2)(2,"button",3),x("click",function(c){return p(r),t.toggleLangSelect(),g(c.stopPropagation())}),M(3,"odx-icon",4),s(),h(4,ne,3,1,"div",5),s(),a(5,"div",6)(6,"div",7)(7,"span"),u(8,"HL7"),s()(),a(9,"form",8,0),x("ngSubmit",function(){return p(r),g(t.submit())}),a(11,"odx-form-field",9)(12,"input",10),f(13,"translate"),v("ngModelChange",function(c){return p(r),y(t.username,c)||(t.username=c),g(c)}),s()(),a(14,"odx-form-field")(15,"input",11),f(16,"translate"),v("ngModelChange",function(c){return p(r),y(t.password,c)||(t.password=c),g(c)}),s()(),h(17,ie,3,4,"odx-form-field",12),a(18,"button",13),u(19),f(20,"translate"),s(),h(21,oe,2,1,"div",14)(22,re,3,3,"div",15),s()(),a(23,"div",16),M(24,"img",17),s()()}e&2&&(o(2),P("aria-expanded",t.showLangSelect?"true":"false"),o(2),d("ngIf",t.showLangSelect),o(7),d("readonly",!0)("disabled",!0),o(),L("ngModel",t.username),d("placeholder",_(13,15,"LOGIN.USERNAME_PLACEHOLDER"))("readonly",!0)("disabled",!0),o(3),L("ngModel",t.password),d("placeholder",_(16,17,"LOGIN.PASSWORD_PLACEHOLDER")),o(2),d("ngIf",t.isFirstLogin),o(),d("disabled",t.loading),o(),b(_(20,19,"LOGIN.SUBMIT")),o(2),d("ngIf",t.error),o(),d("ngIf",!t.error))},dependencies:[G,E,k,H,B,T,V,D,W,A,F,U,K,j,z,q,Z,Y,X,J],styles:[".login-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:24px;background:#fff}.login-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;width:100%}.logo-box[_ngcontent-%COMP%]{width:96px;height:96px;border-radius:12px;background:#103a63;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:34px;letter-spacing:1px;box-shadow:0 4px 16px #0000001f}.login-form[_ngcontent-%COMP%]{width:100%;max-width:600px}.form-field[_ngcontent-%COMP%]{margin-bottom:12px}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:48px;padding:0 16px;border:none;border-radius:10px;background:#e9f1ff;color:#0b2746;font-size:16px;box-shadow:inset 0 0 0 1px #103a6314}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;box-shadow:inset 0 0 0 2px #7aa7ff,0 0 0 3px #7aa7ff26}.login-button[_ngcontent-%COMP%]{width:100%;height:48px;background:#163b63;color:#fff;border:none;border-radius:10px;font-size:16px}.error[_ngcontent-%COMP%]{color:#d92d20;margin:12px 0 0;text-align:center}.logout-msg[_ngcontent-%COMP%]{margin-top:12px;color:#6b7280;text-align:center;font-size:12px}.login-lang-container[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;z-index:1000}.lang-icon-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:8px;border:none;background:transparent;cursor:pointer}.lang-icon[_ngcontent-%COMP%]{width:20px;height:20px;color:#163b63}.lang-fallback[_ngcontent-%COMP%]{font-size:14px;color:#163b63;margin-left:2px}.lang-panel[_ngcontent-%COMP%]{position:absolute;top:40px;right:0;background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:8px;box-shadow:0 8px 24px #0000001f;padding:8px;min-width:180px}.lang-panel[_ngcontent-%COMP%]   odx-select[_ngcontent-%COMP%]{width:100%}.lang-list[_ngcontent-%COMP%]{list-style:none;margin:0;padding:4px 0;max-height:260px;overflow:auto}.lang-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:8px 12px;background:#fff;border:none;border-radius:6px;color:#0b2746;font-size:14px;cursor:pointer}.lang-item[_ngcontent-%COMP%]:hover{background:#f3f6fb}.lang-item.selected[_ngcontent-%COMP%]{background:#e9f1ff}.checkmark[_ngcontent-%COMP%]{color:#163b63;margin-left:12px;font-weight:600}.login-footer[_ngcontent-%COMP%]{position:absolute;bottom:24px;left:0;right:0;display:flex;justify-content:center}.login-footer[_ngcontent-%COMP%]   .draeger-logo[_ngcontent-%COMP%]{height:36px;width:auto;opacity:.95}"]})};export{$ as LoginComponent};
