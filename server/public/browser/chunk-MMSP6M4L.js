import{e as j,g as J,h as U,i as W,j as X,k as G,l as K,m as Q,n as Z,o as ee,p as te,q as ie,r as ne,s as ae}from"./chunk-K4BPTYIL.js";import"./chunk-KVFIUSHT.js";import{a as z,d as Y,i as $,q as R}from"./chunk-OK6HBHM4.js";import{a as oe,b as se}from"./chunk-FM65RC2S.js";import{d as q}from"./chunk-LZGF3L4Y.js";import{$c as H,B as v,Da as C,Eb as B,Ha as I,Ja as E,Oc as V,Ta as o,Ua as s,Wa as u,X as h,Xa as g,Xb as L,Xc as F,Y as f,Za as S,Zb as w,ab as x,ad as k,cb as D,fa as _,i as T,lb as A,mb as l,nb as m,oa as a,ob as M,pb as O,qb as N,rb as P,sa as y,wb as p,xa as b,xb as c}from"./chunk-43CMOHO6.js";function de(e,i){e&1&&(o(0,"th",21),l(1),p(2,"translate"),s()),e&2&&(a(),m(c(2,1,"CODESYSTEM.DETAIL.TABLE.ROW_INDEX")))}function me(e,i){if(e&1&&(o(0,"td",22),l(1),s()),e&2){let t=i.$implicit;a(),m(t.row_id)}}function pe(e,i){e&1&&(o(0,"th",21),l(1),p(2,"translate"),s()),e&2&&(a(),m(c(2,1,"CODESYSTEM.DETAIL.TABLE.OBSERVATION_TYPE")))}function ce(e,i){if(e&1&&(o(0,"td",22),l(1),s()),e&2){let t=i.$implicit;a(),m(t.observationtype)}}function Ce(e,i){e&1&&(o(0,"th",21),l(1),p(2,"translate"),s()),e&2&&(a(),m(c(2,1,"CODESYSTEM.DETAIL.TABLE.DATA_TYPE")))}function ue(e,i){if(e&1&&(o(0,"td",22),l(1),s()),e&2){let t=i.$implicit;a(),m(t.datatype)}}function ge(e,i){e&1&&(o(0,"th",21),l(1),p(2,"translate"),s()),e&2&&(a(),m(c(2,1,"CODESYSTEM.DETAIL.TABLE.ENCODE")))}function he(e,i){if(e&1&&(o(0,"td",22),l(1),s()),e&2){let t=i.$implicit;a(),m(t.encode)}}function fe(e,i){e&1&&(o(0,"th",21),l(1),p(2,"translate"),s()),e&2&&(a(),m(c(2,1,"CODESYSTEM.DETAIL.TABLE.PARAMETER_LABEL")))}function _e(e,i){if(e&1&&(o(0,"td",22),l(1),s()),e&2){let t=i.$implicit;a(),m(t.parameterlabel)}}function ye(e,i){e&1&&(o(0,"th",21),l(1),p(2,"translate"),s()),e&2&&(a(),m(c(2,1,"CODESYSTEM.DETAIL.TABLE.ENCODE_SYSTEM")))}function Ee(e,i){if(e&1&&(o(0,"td",22),l(1),s()),e&2){let t=i.$implicit;a(),m(t.encodesystem)}}function xe(e,i){e&1&&(o(0,"th",21),l(1),p(2,"translate"),s()),e&2&&(a(),m(c(2,1,"CODESYSTEM.DETAIL.TABLE.SUB_ID")))}function Se(e,i){if(e&1&&(o(0,"td",22),l(1),s()),e&2){let t=i.$implicit;a(),m(t.subid)}}function De(e,i){if(e&1){let t=S();o(0,"th",21)(1,"odx-form-field")(2,"input",23,0),p(4,"translate"),x("input",function(){h(t);let r=A(3),d=D();return f(d.filterText.set(r.value))}),s()()()}e&2&&(a(2),I("placeholder",c(4,1,"CODESYSTEM.DETAIL.TABLE.DESCRIPTION")))}function Te(e,i){if(e&1){let t=S();o(0,"td",22)(1,"input",24),P("ngModelChange",function(r){let d=h(t).$implicit;return N(d.description,r)||(d.description=r),f(r)}),x("ngModelChange",function(){let r=h(t).$implicit,d=D();return f(d.onDescriptionInput(r.tagkey,r.description))}),s()()}if(e&2){let t=i.$implicit;a(),O("ngModel",t.description),E("disabled",t.source==="UOM"||!t.source)}}function ve(e,i){e&1&&(o(0,"th",21),l(1),p(2,"translate"),s()),e&2&&(a(),m(c(2,1,"CODESYSTEM.DETAIL.TABLE.SOURCE")))}function be(e,i){if(e&1&&(o(0,"td",22),l(1),s()),e&2){let t=i.$implicit;a(),m(t.source)}}function Ie(e,i){e&1&&(o(0,"th",21),l(1),p(2,"translate"),s()),e&2&&(a(),m(c(2,1,"CODESYSTEM.DETAIL.TABLE.CHANNEL")))}function Ae(e,i){if(e&1&&(o(0,"td",22),l(1),s()),e&2){let t=i.$implicit;a(),m(t.channel)}}function Me(e,i){e&1&&(o(0,"th",21),l(1),p(2,"translate"),s()),e&2&&(a(),m(c(2,1,"CODESYSTEM.DETAIL.TABLE.CHANNEL_ID")))}function Oe(e,i){if(e&1&&(o(0,"td",22),l(1),s()),e&2){let t=i.$implicit;a(),m(t.channelid)}}var re=class e{constructor(i,t,n){this.codesystemService=i;this.router=t;this.route=n;this.descriptionInput$.pipe(v(1e3)).subscribe(({tagkey:r,val:d})=>{this.onEditDescription(r,d)})}filterText=_("");codesystemData=_([]);originalcodesystemData=[];errorMessage="";id="";codesystemName="";page=1;pageSize=1e3;totalPages=0;totalItems=0;previousPageIndex=0;paginationParams=_({pageSize:this.pageSize,length:this.totalItems,pageIndex:this.page});variantValue=F.SECONDARY;tablevariantValue=W.STRIPED;descriptionInput$=new T;getCodesystemDisplayName=oe;filteredData(){let i=[],t=this.codesystemData();return t&&Array.isArray(t)?t.forEach(n=>{i.push({row_id:n.id||"",tagkey:n.tagkey||"",observationtype:n.observationtype||"",datatype:n.datatype||"",encode:n.encode||"",parameterlabel:n.parameterlabel||"",encodesystem:n.encodesystem||"",subid:n.subid||"",description:n.description||"",source:n.source||"",channel:n.channel||"",channelid:n.channelid||""})}):console.error("codesystem is invalid or empty.",t),i}dataSource=B(()=>this.filteredData().filter(i=>i.description.toLowerCase().includes(this.filterText().toLowerCase())));displayedColumns=["row_id","observationtype","datatype","encode","parameterlabel","encodesystem","subid","description","source","channel","channelid"];ngOnInit(){this.route.paramMap.subscribe(i=>{this.id=i.get("id")||"",console.log("id:",this.id)}),this.route.queryParamMap.subscribe(i=>{this.codesystemName=i.get("codesystemname")||"",console.log("codesystemname:",this.codesystemName)}),this.id&&this.codesystemName&&this.queryCodesystemDetail(this.id,this.codesystemName)}onDescriptionInput(i,t){this.descriptionInput$.next({tagkey:i,val:t})}onEditDescription(i,t){let n=this.originalcodesystemData.find(r=>r.tagkey===i);if(n?.description!=t){let r=JSON.parse(JSON.stringify(n));r.description=t;let d=Array.of(r);Array.isArray(d)&&d.every(le=>le!==void 0)&&this.submitChanges(d)}}submitChanges(i){console.log("submit changed data:"),this.codesystemService.updateCodesystem(this.codesystemName,i).subscribe(t=>{console.log("update codesystem successfully:",t),t.success&&window.alert(`Total ${t.updated} data are updated.`),this.queryCodesystemDetail(this.id,this.codesystemName,this.page)})}onPageChange(i){let t=i.pageIndex;t>this.previousPageIndex?console.log("next page \u2192"):t<this.previousPageIndex?console.log("\u2190 previous page"):console.log("page not changed"),this.previousPageIndex=t,this.page=t+1,this.pageSize=i.pageSize,this.paginationParams.set({pageSize:this.pageSize,length:this.totalItems,pageIndex:t}),this.queryCodesystemDetail(this.id,this.codesystemName,this.page)}queryCodesystemDetail(i,t,n=1){this.errorMessage="",this.codesystemData.set([]),this.codesystemService.getPaginatedCodesystemDetailById(i,t,n,this.pageSize).subscribe({next:r=>{let d=Array.isArray(r)&&r.length>0?r[0]:null;d?(this.codesystemData.set(d.rows||[]),this.originalcodesystemData=JSON.parse(JSON.stringify(d.rows)),this.page=d.page,this.pageSize=d.pageSize,this.totalPages=d.totalPages,this.totalItems=d.total,this.paginationParams.set({pageSize:this.pageSize,length:this.totalItems,pageIndex:this.page-1})):(this.codesystemData.set([]),this.errorMessage="Server returned invalid data format",console.error("Server returned invalid data format",r))},error:r=>{this.codesystemData.set([]),this.errorMessage=r.message,console.error(r)}})}static \u0275fac=function(t){return new(t||e)(y(se),y(w),y(L))};static \u0275cmp=b({type:e,selectors:[["app-codesystemdetail"]],decls:45,vars:10,consts:[["filter",""],[1,"odx-app-page"],["size","large"],[1,"grid"],[1,"grid-container"],["odxDataTable","",3,"variant","dataSource","displayedColumns"],["odxColumnDef","row_id"],["odxHeaderCell","",4,"odxHeaderCellDef"],["odxCell","",4,"odxCellDef"],["odxColumnDef","observationtype"],["odxColumnDef","datatype"],["odxColumnDef","encode"],["odxColumnDef","parameterlabel"],["odxColumnDef","encodesystem"],["odxColumnDef","subid"],["odxColumnDef","description"],["odxColumnDef","source"],["odxColumnDef","channel"],["odxColumnDef","channelid"],[1,"odx-app-page__footer"],[3,"pageChanged","pageSize","length","pageIndex"],["odxHeaderCell",""],["odxCell",""],["type","text","odxFormFieldControl","",3,"input"],[3,"ngModelChange","ngModel","disabled"]],template:function(t,n){t&1&&(o(0,"div",1)(1,"odx-area-header",2),l(2),s(),o(3,"div",3)(4,"div",4)(5,"div")(6,"table",5),u(7,6),C(8,de,3,3,"th",7)(9,me,2,1,"td",8),g(),u(10,9),C(11,pe,3,3,"th",7)(12,ce,2,1,"td",8),g(),u(13,10),C(14,Ce,3,3,"th",7)(15,ue,2,1,"td",8),g(),u(16,11),C(17,ge,3,3,"th",7)(18,he,2,1,"td",8),g(),u(19,12),C(20,fe,3,3,"th",7)(21,_e,2,1,"td",8),g(),u(22,13),C(23,ye,3,3,"th",7)(24,Ee,2,1,"td",8),g(),u(25,14),C(26,xe,3,3,"th",7)(27,Se,2,1,"td",8),g(),u(28,15),C(29,De,5,3,"th",7)(30,Te,2,2,"td",8),g(),u(31,16),C(32,ve,3,3,"th",7)(33,be,2,1,"td",8),g(),u(34,17),C(35,Ie,3,3,"th",7)(36,Ae,2,1,"td",8),g(),u(37,18),C(38,Me,3,3,"th",7)(39,Oe,2,1,"td",8),g(),o(40,"odx-table-empty"),l(41),p(42,"translate"),s()()()()(),o(43,"div",19)(44,"odx-paginator",20),x("pageChanged",function(d){return n.onPageChange(d)}),s()()()),t&2&&(a(2),M(" ",n.getCodesystemDisplayName(n.codesystemName)," "),a(4),E("variant",n.tablevariantValue)("dataSource",n.dataSource())("displayedColumns",n.displayedColumns),a(35),m(c(42,8,"COMMON.NOT_FOUND")),a(3),E("pageSize",n.pageSize)("length",n.totalItems)("pageIndex",n.page-1))},dependencies:[q,ae,ne,ie,V,te,X,Q,K,ee,G,Z,U,J,j,R,z,Y,$,k,H],styles:[".grid-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.grid-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1;max-height:70vh;overflow-y:auto}"]})};export{re as CodesystemdetailComponent};
