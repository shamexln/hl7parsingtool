import{a as N}from"./chunk-5YKHTYQY.js";import{a as b,d as y,e as P,g as A,i as G,j as T,m as D,n as V,o as B,p as W,q as F}from"./chunk-OK6HBHM4.js";import{$c as H,Da as x,Ja as c,Lb as E,Ob as M,Ta as o,Ua as r,X as f,Y as h,Yc as U,Za as C,Zb as R,_c as q,ab as S,ad as j,cb as O,mb as d,nb as m,oa as n,pb as _,qb as L,rb as I,sa as w,wb as l,xa as v,xb as p}from"./chunk-43CMOHO6.js";function z(a,t){if(a&1){let i=C();o(0,"div",5)(1,"input",18),l(2,"translate"),I("ngModelChange",function(g){f(i);let u=O();return L(u.confirmPassword,g)||(u.confirmPassword=g),h(g)}),r()()}if(a&2){let i=O();n(),_("ngModel",i.confirmPassword),c("placeholder",p(2,2,"LOGIN.CONFIRM_PASSWORD_PLACEHOLDER"))}}function J(a,t){if(a&1&&(o(0,"div",19),d(1),r()),a&2){let i=O();n(),m(i.error)}}function K(a,t){a&1&&(o(0,"div",20),d(1),l(2,"translate"),r()),a&2&&(n(),m(p(2,1,"LOGIN.LOGGED_OUT")))}var k=class a{constructor(t,i,e){this.auth=t;this.router=i;this.translate=e;this.selectedLang=e.currentLang||e.getDefaultLang()||"en"}username="";password="";confirmPassword="";isFirstLogin=!1;error="";loading=!1;selectedLang="en";ngOnInit(){this.auth.setupRequired().subscribe(t=>{this.isFirstLogin=!!t})}setLang(t){let e=["en","fr","de","es"].includes(t)?t:"en";this.translate.use(e);try{localStorage.setItem("hl7_lang",e)}catch{}}submit(){if(this.error="",this.loading=!0,this.isFirstLogin){if(this.password!==this.confirmPassword){this.loading=!1;let t=this.translate.instant("LOGIN.ERROR_PASSWORD_MISMATCH");this.error=t&&t!=="LOGIN.ERROR_PASSWORD_MISMATCH"?t:"Passwords do not match";return}this.auth.setupInitial(this.username,this.password,this.confirmPassword).subscribe({next:t=>{if(t)this.auth.login(this.username,this.password).subscribe({next:i=>{this.loading=!1,i?this.router.navigate(["/patient-query"]):this.error=this.translate.instant("LOGIN.ERROR_INVALID")},error:()=>{this.loading=!1,this.error=this.translate.instant("LOGIN.ERROR_INVALID")}});else{this.loading=!1;let i=this.translate.instant("LOGIN.ERROR_SETUP_FAILED");this.error=i&&i!=="LOGIN.ERROR_SETUP_FAILED"?i:"Initial setup failed"}},error:()=>{this.loading=!1;let t=this.translate.instant("LOGIN.ERROR_SETUP_FAILED");this.error=t&&t!=="LOGIN.ERROR_SETUP_FAILED"?t:"Initial setup failed"}});return}this.auth.login(this.username,this.password).subscribe({next:t=>{this.loading=!1,t?this.router.navigate(["/patient-query"]):this.error=this.translate.instant("LOGIN.ERROR_INVALID")},error:()=>{this.loading=!1,this.error=this.translate.instant("LOGIN.ERROR_INVALID")}})}static \u0275fac=function(i){return new(i||a)(w(N),w(R),w(q))};static \u0275cmp=v({type:a,selectors:[["app-login"]],decls:36,vars:31,consts:[["f","ngForm"],[1,"login-wrapper"],[1,"login-card"],["aria-hidden","true",1,"logo-box"],[1,"login-form",3,"ngSubmit"],[1,"form-field"],["for","language",1,"lang-label"],["id","language","name","language",3,"ngModelChange","change","ngModel"],["value","en"],["value","fr"],["value","de"],["value","es"],["id","username","name","username","type","text","required","",3,"ngModelChange","ngModel","placeholder"],["id","password","name","password","type","password","required","",3,"ngModelChange","ngModel","placeholder"],["class","form-field",4,"ngIf"],["odxButton","","type","submit",1,"login-button",3,"disabled"],["class","error",4,"ngIf"],["class","logout-msg",4,"ngIf"],["id","confirmPassword","name","confirmPassword","type","password","required","",3,"ngModelChange","ngModel","placeholder"],[1,"error"],[1,"logout-msg"]],template:function(i,e){if(i&1){let g=C();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"span"),d(4,"HL7"),r()(),o(5,"form",4,0),S("ngSubmit",function(){return f(g),h(e.submit())}),o(7,"div",5)(8,"label",6),d(9),l(10,"translate"),r(),o(11,"select",7),I("ngModelChange",function(s){return f(g),L(e.selectedLang,s)||(e.selectedLang=s),h(s)}),S("change",function(){return f(g),h(e.setLang(e.selectedLang))}),o(12,"option",8),d(13),l(14,"translate"),r(),o(15,"option",9),d(16),l(17,"translate"),r(),o(18,"option",10),d(19),l(20,"translate"),r(),o(21,"option",11),d(22),l(23,"translate"),r()()(),o(24,"div",5)(25,"input",12),l(26,"translate"),I("ngModelChange",function(s){return f(g),L(e.username,s)||(e.username=s),h(s)}),r()(),o(27,"div",5)(28,"input",13),l(29,"translate"),I("ngModelChange",function(s){return f(g),L(e.password,s)||(e.password=s),h(s)}),r()(),x(30,z,3,4,"div",14),o(31,"button",15),d(32),l(33,"translate"),r(),x(34,J,2,1,"div",16)(35,K,3,3,"div",17),r()()()}i&2&&(n(9),m(p(10,15,"LOGIN.LANGUAGE.LABEL")),n(2),_("ngModel",e.selectedLang),n(2),m(p(14,17,"LOGIN.LANGUAGE.EN")),n(3),m(p(17,19,"LOGIN.LANGUAGE.FR")),n(3),m(p(20,21,"LOGIN.LANGUAGE.DE")),n(3),m(p(23,23,"LOGIN.LANGUAGE.ES")),n(3),_("ngModel",e.username),c("placeholder",p(26,25,"LOGIN.USERNAME_PLACEHOLDER")),n(3),_("ngModel",e.password),c("placeholder",p(29,27,"LOGIN.PASSWORD_PLACEHOLDER")),n(2),c("ngIf",e.isFirstLogin),n(),c("disabled",e.loading),n(),m(p(33,29,"LOGIN.SUBMIT")),n(2),c("ngIf",e.error),n(),c("ngIf",!e.error))},dependencies:[M,E,F,T,V,B,b,D,y,P,W,G,A,U,j,H],styles:[".login-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:24px;background:#fff}.login-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;width:100%}.logo-box[_ngcontent-%COMP%]{width:96px;height:96px;border-radius:12px;background:#103a63;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:34px;letter-spacing:1px;box-shadow:0 4px 16px #0000001f}.login-form[_ngcontent-%COMP%]{width:100%;max-width:600px}.form-field[_ngcontent-%COMP%]{margin-bottom:12px}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:48px;padding:0 16px;border:none;border-radius:10px;background:#e9f1ff;color:#0b2746;font-size:16px;box-shadow:inset 0 0 0 1px #103a6314}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;box-shadow:inset 0 0 0 2px #7aa7ff,0 0 0 3px #7aa7ff26}.login-button[_ngcontent-%COMP%]{width:100%;height:48px;background:#163b63;color:#fff;border:none;border-radius:10px;font-size:16px}.error[_ngcontent-%COMP%]{color:#d92d20;margin:12px 0 0;text-align:center}.logout-msg[_ngcontent-%COMP%]{margin-top:12px;color:#6b7280;text-align:center;font-size:12px}"]})};export{k as LoginComponent};
