import{a as ie,b as ne,c as ae,d as oe,e as le,f as se,g as re,h as de,i as me,j as pe,k as ce}from"./chunk-7FB65LAP.js";import{a as ue,b as Ce,c as ge,d as he,e as fe,f as _e,g as ye}from"./chunk-DQ6KATE4.js";import{a as Q,c as X,d as G}from"./chunk-LDSH5ZEA.js";import{a as H,d as k,i as q,s as U}from"./chunk-EUUJERWT.js";import"./chunk-IVREERM6.js";import{a as xe,b as Ee}from"./chunk-KHUNEOLT.js";import{d as te}from"./chunk-ALHQIKHA.js";import{$a as S,B as b,Bb as R,Fa as u,Gb as Y,Ja as M,La as h,Uc as W,Va as l,Wa as s,Xa as A,Y as _,Ya as C,Z as y,Za as g,ac as $,bd as j,cb as D,cc as F,cd as J,eb as v,ga as E,gd as K,hd as Z,i as T,ib as O,id as ee,jb as N,kb as L,nb as P,ob as r,pb as d,qa as o,qb as B,rb as w,sb as V,tb as z,ua as x,yb as p,za as I,zb as c}from"./chunk-PQW76BEZ.js";var De=["modal"];function ve(e,i){e&1&&(l(0,"th",23),r(1),p(2,"translate"),s()),e&2&&(o(),d(c(2,1,"CODESYSTEM.DETAIL.TABLE.ROW_INDEX")))}function Te(e,i){if(e&1&&(l(0,"td",24),r(1),s()),e&2){let t=i.$implicit;o(),d(t.row_id)}}function be(e,i){e&1&&(l(0,"th",23),r(1),p(2,"translate"),s()),e&2&&(o(),d(c(2,1,"CODESYSTEM.DETAIL.TABLE.OBSERVATION_TYPE")))}function Ie(e,i){if(e&1&&(l(0,"td",24),r(1),s()),e&2){let t=i.$implicit;o(),d(t.observationtype)}}function Me(e,i){e&1&&(l(0,"th",23),r(1),p(2,"translate"),s()),e&2&&(o(),d(c(2,1,"CODESYSTEM.DETAIL.TABLE.DATA_TYPE")))}function Ae(e,i){if(e&1&&(l(0,"td",24),r(1),s()),e&2){let t=i.$implicit;o(),d(t.datatype)}}function Oe(e,i){e&1&&(l(0,"th",23),r(1),p(2,"translate"),s()),e&2&&(o(),d(c(2,1,"CODESYSTEM.DETAIL.TABLE.ENCODE")))}function Ne(e,i){if(e&1&&(l(0,"td",24),r(1),s()),e&2){let t=i.$implicit;o(),d(t.encode)}}function Le(e,i){e&1&&(l(0,"th",23),r(1),p(2,"translate"),s()),e&2&&(o(),d(c(2,1,"CODESYSTEM.DETAIL.TABLE.PARAMETER_LABEL")))}function Pe(e,i){if(e&1&&(l(0,"td",24),r(1),s()),e&2){let t=i.$implicit;o(),d(t.parameterlabel)}}function Be(e,i){e&1&&(l(0,"th",23),r(1),p(2,"translate"),s()),e&2&&(o(),d(c(2,1,"CODESYSTEM.DETAIL.TABLE.ENCODE_SYSTEM")))}function we(e,i){if(e&1&&(l(0,"td",24),r(1),s()),e&2){let t=i.$implicit;o(),d(t.encodesystem)}}function Ve(e,i){e&1&&(l(0,"th",23),r(1),p(2,"translate"),s()),e&2&&(o(),d(c(2,1,"CODESYSTEM.DETAIL.TABLE.SUB_ID")))}function ze(e,i){if(e&1&&(l(0,"td",24),r(1),s()),e&2){let t=i.$implicit;o(),d(t.subid)}}function Re(e,i){if(e&1){let t=S();l(0,"th",23)(1,"odx-form-field")(2,"input",25,1),p(4,"translate"),D("input",function(){_(t);let a=P(3),m=v();return y(m.filterText.set(a.value))}),s()()()}e&2&&(o(2),M("placeholder",c(4,1,"CODESYSTEM.DETAIL.TABLE.DESCRIPTION")))}function Ye(e,i){if(e&1){let t=S();l(0,"td",24)(1,"input",26),z("ngModelChange",function(a){let m=_(t).$implicit;return V(m.description,a)||(m.description=a),y(a)}),D("ngModelChange",function(){let a=_(t).$implicit,m=v();return y(m.onDescriptionInput(a.tagkey,a.description))}),s()()}if(e&2){let t=i.$implicit;o(),w("ngModel",t.description),h("disabled",t.source==="UOM"||!t.source)}}function $e(e,i){e&1&&(l(0,"th",23),r(1),p(2,"translate"),s()),e&2&&(o(),d(c(2,1,"CODESYSTEM.DETAIL.TABLE.SOURCE")))}function Fe(e,i){if(e&1&&(l(0,"td",24),r(1),s()),e&2){let t=i.$implicit;o(),d(t.source)}}function He(e,i){e&1&&(l(0,"th",23),r(1),p(2,"translate"),s()),e&2&&(o(),d(c(2,1,"CODESYSTEM.DETAIL.TABLE.CHANNEL")))}function ke(e,i){if(e&1&&(l(0,"td",24),r(1),s()),e&2){let t=i.$implicit;o(),d(t.channel)}}function qe(e,i){e&1&&(l(0,"th",23),r(1),p(2,"translate"),s()),e&2&&(o(),d(c(2,1,"CODESYSTEM.DETAIL.TABLE.CHANNEL_ID")))}function Ue(e,i){if(e&1&&(l(0,"td",24),r(1),s()),e&2){let t=i.$implicit;o(),d(t.channelid)}}function We(e,i){if(e&1&&(A(0,"odx-modal-hero",27),l(1,"odx-modal-content")(2,"p")(3,"strong"),r(4),s()()(),l(5,"odx-modal-footer")(6,"button",28),r(7),p(8,"translate"),s()()),e&2){let t=i.$implicit;h("icon",t.data==null?null:t.data.heroIcon)("variant",t.data==null?null:t.data.heroVariant),o(4),d(t.data==null?null:t.data.message),o(3),d(c(8,4,"COMMON.CLOSE"))}}var Se=class e{constructor(i,t,n,a){this.codesystemService=i;this.router=t;this.route=n;this.translate=a;this.descriptionInput$.pipe(b(1e3)).subscribe(({tagkey:m,val:f})=>{this.onEditDescription(m,f)})}modal;filterText=E("");codesystemData=E([]);originalcodesystemData=[];errorMessage="";id="";codesystemName="";page=1;pageSize=1e3;totalPages=0;totalItems=0;previousPageIndex=0;paginationParams=E({pageSize:this.pageSize,length:this.totalItems,pageIndex:this.page});variantValue=j.SECONDARY;tablevariantValue=ie.STRIPED;descriptionInput$=new T;getCodesystemDisplayName=xe;filteredData(){let i=[],t=this.codesystemData();return t&&Array.isArray(t)?t.forEach(n=>{i.push({row_id:n.id||"",tagkey:n.tagkey||"",observationtype:n.observationtype||"",datatype:n.datatype||"",encode:n.encode||"",parameterlabel:n.parameterlabel||"",encodesystem:n.encodesystem||"",subid:n.subid||"",description:n.description||"",source:n.source||"",channel:n.channel||"",channelid:n.channelid||""})}):console.error("codesystem is invalid or empty.",t),i}dataSource=Y(()=>this.filteredData().filter(i=>i.description.toLowerCase().includes(this.filterText().toLowerCase())));displayedColumns=["row_id","observationtype","datatype","encode","parameterlabel","encodesystem","subid","description","source","channel","channelid"];args;openModalWithData(i,t="info",n="success",a){this.args={data:{message:i,heroIcon:t,heroVariant:n},size:ue.XSMALL},this.modal.open();let m=this.modal.modalClose?.subscribe(()=>{m?.unsubscribe(),a&&a()})}ngOnInit(){this.route.paramMap.subscribe(i=>{this.id=i.get("id")||"",console.log("id:",this.id)}),this.route.queryParamMap.subscribe(i=>{this.codesystemName=i.get("codesystemname")||"",console.log("codesystemname:",this.codesystemName)}),this.id&&this.codesystemName&&this.queryCodesystemDetail(this.id,this.codesystemName)}onDescriptionInput(i,t){this.descriptionInput$.next({tagkey:i,val:t})}onEditDescription(i,t){let n=this.originalcodesystemData.find(a=>a.tagkey===i);if(n?.description!=t){let a=JSON.parse(JSON.stringify(n));a.description=t;let m=Array.of(a);Array.isArray(m)&&m.every(f=>f!==void 0)&&this.submitChanges(m)}}submitChanges(i){console.log("submit changed data:"),this.codesystemService.updateCodesystem(this.codesystemName,i).subscribe(t=>{if(console.log("update codesystem successfully:",t),t.success){let n=this.translate.instant("CODESYSTEM.UPDATED_COUNT",{count:t.updated});this.openModalWithData(n,"info","success",()=>{this.queryCodesystemDetail(this.id,this.codesystemName,this.page)})}})}onPageChange(i){let t=i.pageIndex;t>this.previousPageIndex?console.log("next page \u2192"):t<this.previousPageIndex?console.log("\u2190 previous page"):console.log("page not changed"),this.previousPageIndex=t,this.page=t+1,this.pageSize=i.pageSize,this.paginationParams.set({pageSize:this.pageSize,length:this.totalItems,pageIndex:t}),this.queryCodesystemDetail(this.id,this.codesystemName,this.page)}queryCodesystemDetail(i,t,n=1){this.errorMessage="",this.codesystemData.set([]),this.codesystemService.getPaginatedCodesystemDetailById(i,t,n,this.pageSize).subscribe({next:a=>{let m=Array.isArray(a)&&a.length>0?a[0]:null;m?(this.codesystemData.set(m.rows||[]),this.originalcodesystemData=JSON.parse(JSON.stringify(m.rows)),this.page=m.page,this.pageSize=m.pageSize,this.totalPages=m.totalPages,this.totalItems=m.total,this.paginationParams.set({pageSize:this.pageSize,length:this.totalItems,pageIndex:this.page-1})):(this.codesystemData.set([]),this.errorMessage=this.translate.instant("MSG.INVALID_DATA_FORMAT"),console.error("Server returned invalid data format",a))},error:a=>{this.codesystemData.set([]),this.errorMessage=a.message,console.error(a)}})}static \u0275fac=function(t){return new(t||e)(x(Ee),x(F),x($),x(K))};static \u0275cmp=I({type:e,selectors:[["app-codesystemdetail"]],viewQuery:function(t,n){if(t&1&&O(De,7),t&2){let a;N(a=L())&&(n.modal=a.first)}},decls:47,vars:11,consts:[["modal","odxModal"],["filter",""],[1,"odx-app-page"],["size","large"],[1,"grid"],[1,"grid-container"],["odxDataTable","",3,"variant","dataSource","displayedColumns"],["odxColumnDef","row_id"],["odxHeaderCell","",4,"odxHeaderCellDef"],["odxCell","",4,"odxCellDef"],["odxColumnDef","observationtype"],["odxColumnDef","datatype"],["odxColumnDef","encode"],["odxColumnDef","parameterlabel"],["odxColumnDef","encodesystem"],["odxColumnDef","subid"],["odxColumnDef","description"],["odxColumnDef","source"],["odxColumnDef","channel"],["odxColumnDef","channelid"],[1,"odx-app-page__footer"],[3,"pageChanged","pageSize","length","pageIndex"],[3,"odxModal"],["odxHeaderCell",""],["odxCell",""],["type","text","odxFormFieldControl","",3,"input"],[3,"ngModelChange","ngModel","disabled"],[3,"icon","variant"],["odxButton","","variant","primary","odxModalClose",""]],template:function(t,n){if(t&1){let a=S();l(0,"div",2)(1,"odx-area-header",3),r(2),s(),l(3,"div",4)(4,"div",5)(5,"div")(6,"table",6),C(7,7),u(8,ve,3,3,"th",8)(9,Te,2,1,"td",9),g(),C(10,10),u(11,be,3,3,"th",8)(12,Ie,2,1,"td",9),g(),C(13,11),u(14,Me,3,3,"th",8)(15,Ae,2,1,"td",9),g(),C(16,12),u(17,Oe,3,3,"th",8)(18,Ne,2,1,"td",9),g(),C(19,13),u(20,Le,3,3,"th",8)(21,Pe,2,1,"td",9),g(),C(22,14),u(23,Be,3,3,"th",8)(24,we,2,1,"td",9),g(),C(25,15),u(26,Ve,3,3,"th",8)(27,ze,2,1,"td",9),g(),C(28,16),u(29,Re,5,3,"th",8)(30,Ye,2,2,"td",9),g(),C(31,17),u(32,$e,3,3,"th",8)(33,Fe,2,1,"td",9),g(),C(34,18),u(35,He,3,3,"th",8)(36,ke,2,1,"td",9),g(),C(37,19),u(38,qe,3,3,"th",8)(39,Ue,2,1,"td",9),g(),l(40,"odx-table-empty"),r(41),p(42,"translate"),s()()()()(),l(43,"div",20)(44,"odx-paginator",21),D("pageChanged",function(f){return _(a),y(n.onPageChange(f))}),s()()(),u(45,We,9,6,"ng-template",22,0,R)}t&2&&(o(2),B(" ",n.getCodesystemDisplayName(n.codesystemName)," "),o(4),h("variant",n.tablevariantValue)("dataSource",n.dataSource())("displayedColumns",n.displayedColumns),o(35),d(c(42,9,"COMMON.NOT_FOUND")),o(3),h("pageSize",n.pageSize)("length",n.totalItems)("pageIndex",n.page-1),o(),h("odxModal",n.args))},dependencies:[te,ce,pe,me,W,de,ne,le,oe,re,ae,se,G,X,Q,U,H,k,q,ee,Z,ye,J,fe,he,_e,Ce,ge],styles:[".grid-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.grid-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1;max-height:70vh;overflow-y:auto}"]})};export{Se as CodesystemdetailComponent};
